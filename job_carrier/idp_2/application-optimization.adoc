= Анализ производительности и оптимизация приложений

Для обеспечения эффективности и надежности приложения инженер производительности проводит анализ быстродействия приложения. Для этого он собирает и анализирует метрики, полученные из приложения или специализированных инструментов

== Метрики
Сбор метрик это первый и самый важный этап в анализе производительности приложения. На данном этапе происходит анализ: какие данные будут собираться, каким способом, как они будут структурироваться и т.д.

== Метрики Java приложения:

* Время отклика (Response Time) – временной промежуток, в течение которого приложение обрабатывает входящий запрос и отправляет результат обратно клиенту.
** Spring Boot предоставляет инструмент под названием Spring Boot Actuator, позволяющий получить метрику времени отклика, путём установки декоратора над замеряемым методом.
** Аналогичный способ измерение времени отклика – использование аспекто-ориентированного программирования, путём внедрения аспектов для перехвата выполнения методов контроллеров и измерения времени выполнения;

* Пропускная способность (Throughput) – количество транзакций или запросов, обработанных приложением за единицу времени.
** Spring Boot Actuator предоставляет возможность отслеживания количества обработанных запросов. Аналогичный способ измерения пропускной способности – использовать библиотеку Micrometer;

* Использование ресурсов (Resource Utilization): Эта категория включает в себя метрики использования ЦПУ (CPU utilization), памяти (RAM utilization), сетевых (Network utilization) и дисковых ресурсов.
** Данные могут быть получены путем интеграции с библиотеками типа Micrometer;

* Коэффициент ошибок (Error Rate): Процент неудачных запросов по сравнению с общим числом обработанных запросов.
** Сбор данных возможен посредством использования аспекто-ориентированного программирования, для перехвата исключений, или через трассировку в приложении.

== Метрики Java Vritual Machine

Метрики Java Virtual Machine (JVM) отображают состояние и производительность виртуальной машины, на которой работает Java-приложение. Основные метрики и методы их сбора:

* Утилизация ЦПУ (CPU Utilization): Процент использования ЦПУ в процессе выполнения JVM
** Метрика может быть собрана с использованием JMX (Java Management Extensions) или через инструменты, такие как VisualVM и JConsole;

* Потребление памяти (Memory Usage): Включает использование heap и non-heap памяти.
** Метрики собираются посредством JMX, Garbage Collection (GC) логов;

* Время сборки мусора (Garbage Collection Time): Время, затраченное на сборку неиспользуемых объектов JVM.
** Информация о времени сборки мусора может быть получена из GC логов и JMX возможностей, а также профилировщиков;

* Количество активных потоков (Thread Count): Метрика определяет общее число активных потоков в JVM.
** JMX и встроенные инструменты JVM, такие, как JConsole, предоставляют эту информацию;

* Число открытых соединений к базе данных (Database Connection Count): Метрика измеряет количество текущих активных соединений к базе данных.
** Актуальные данные могут быть получены при помощи JMX.

== Java Management Extensions (JMX)
Java Management Extensions (JMX) является стандартной технологией Java, предоставляющей средства управления и мониторинга приложений. JMX позволяет собирать данные о нагрузке на CPU, потреблении памяти, количестве активных потоков, времени работы сборщика мусора и многим другим метрикам.

На практике JMX представляет собой утилиту, позволяющую подключиться к приложению и собирать метрики для дальнейшего анализа:

* Spring Boot Actuator представляет собой расширение для приложений, написанных с применением фреймворка Spring Boot, которое включает в себя готовые эндпоинты для мониторинга и управления. На практике работа со Spring Boot Actuator состоит из подключения, которое представляет собой добавление зависимости в проект Mavan или Grandle и конфигурацию эндпоинтов.
* Micrometer является проектом с открытым исходным кодом и предоставляет метрический фасад, который отображает метрические данные в независимом от поставщика формате, понятном системе мониторинга. На практике работа с Micrometer состоит из подключения Micrometer и конфигурации метрик.

== Методы и инструменты для сбора метрик

* Prometheus представляет собой систему мониторинга и оповещения с открытым исходным кодом, разработанную для хранения временных рядов данных. Prometheus подходит для сбора метрик благодаря своим возможностям по сбору данных с помощью pull-модели и модели запросов на языке PromQLZ
* Graphite является инструментом, ориентированным на сбор и отображение временных рядов данных. Он состоит из трех основных компонентов: Carbon, реализующий сбор данных, Whisper для их хранения и Graphite Web для визуализации.

== Инструменты для хранения метрик

* InfluxDB – это база данных временных рядов, разработанная с самого раннего этапа, чтобы справляться с высокими нагрузками на запись и запросы
* OpenTSDB – это распределенная база данных для временных рядов, работающая поверх Hadoop. Она предназначена для хранения и обработки больших объемов метрик, обеспечивая высокую надежность и масштабируемость;
* Elasticsearch – это распределенная поисковая и аналитическая система, которая также используется для хранения метрик. В связке с Logstash она предоставляет функционал сбора, обработки, поиска, анализа и хранения метрик в реальном времени.

== Инструменты для визуализации метрик

* Grafana является лидирующим инструментом визуализации, который поддерживает интеграции с различными источниками данных, включая Prometheus, InfluxDB, Elasticsearch и другие. Grafana предоставляет широкий спектр возможностей для создания интерактивных дашбордов и визуализаций.
* Kibana – это инструмент для визуализации данных, хранящихся в Elasticsearch. Он предлагает широкий спектр возможностей для создания дашбордов и анализа данных, обеспечивая удобный интерфейс, для отображения и визуализации метрик.