# Вопросы для собеседования на Java Developer
## Вопросы по SQL

### SELECT - порядок выполнения
```sql
SELECT DISTINCT column_list
FROM table_name
JOIN other_table ON join_condition
WHERE where_condition
GROUP BY group_columns
HAVING having_condition
ORDER BY order_columns
LIMIT limit_value
OFFSET offset_value;
```

### Типы таблиц в PostgreSQL
#### Кластеризизованные таблицы
* Кластеризизованные таблицы - таблицы, в которых записи отсортированы командой CLUSTER.
* Цель кластеризации — избегать ненужных ORDER BY в постоянных запросах к таблице по кластеризованному полю или полям.
* Используются для справочников или редко изменяемых таблиц, так как любое выполнение [INSERT|UPDATE|DELETE] хоть для дной записи нарушает порядок в таблице.
* Чтобы вновь сделать записи отсортированными, нужно выполнить команду: ```sql CLUSTER VERBOSE <Название таблицы> USING <Название индекса для сортировки>; ```
* Признак в метаданных таблицы, что он кластерилизованна - флаг relhasindex = true

#### Внешние таблицы
* Внешние таблицы - таблицы из внешних источников (csv-файл, таблица из другой РСУБД или из некоторых noSQL БД).
* Цель — интеграция данных другого источника, если есть возможность к нему присоединиться (но сами запросы на чтения выполняются дольше, а INSERT, UPDATE, DELETE как правило недоступны).
* Используется обычно для чтения логов, чтение из внешних систем, прототипирование БД, миграция данных.
* Признак в метаданных таблицы, колонка subtype = 'f'
* Как создать:
```sql
CREATE EXTENSION file_fdw; -- Подключаем расширение file_fdw, основанное на fdw — foreign data wrapper
CREATE SERVER csv_log FOREIGN DATA WRAPPER file_fdw; -- создаётся виртуальный сервер csv_log, использующий механизм file_fdw

CREATE FOREIGN TABLE test.csv (
  id       INTEGER,
  name VARCHAR
) SERVER csv_log  -- указывается, что таблица использует сервер csv_log
  OPTIONS (filename '/var/lib/postgresql/file.csv', -- задаются параметры доступа к файлу
                   delimiter ';', format 'csv');
```
  
####  Партицированные таблицы
* Партиционированные таблицы - это таблицы, разделенные на меньшие, логически связанные части (партиции) на основе определённых правил, при этом для приложения таблицы выглядит как единое целое.
* Цель - улучшение производительности запросов за счет сокращения объема сканируемых данных (упрощение управления таблицами (бэкапы, чистка), оптимизация загрузки и выгрузки данных, повышение доступности данных).
* Используется для больших таблиц, которые можно "равномерно" сегментировать (по периодам, по географической принадлежности, по бизнес-критериям и т.д.)
* Условия: условия партиционирования должны включать ключ партиционирования в WHERE, уникальные индексы должны включать ключ партиционирования.
* Признак в метаданных таблицы по слову partition
 
####  Наследуемые таблицы
* Наследуемые таблицы - это таблицы, которые наследует структуру и данные родительских таблиц .
* Цель - логическая организация сложных доменных моделей
* Ограничения : PK/FK не наследуются, отсутствует каскасдное удаление
* Оператор для создания наследуемой таблицы - INHERITS.

### Представления (VIEW)
__View (Представление)__ - это сохранённый SQL-запрос, который ведёт себя как виртуальная таблица. Данные физически не хранятся — при каждом обращении к view выполняется её базовый запрос к реальным таблицам. Всегда возвращает актуальные данные.

__Materialized View (Материализованное представление)__ - это снимок результата запроса, сохранённый как реальная таблица. Данные физически хранятся и требуют явного обновления. Работает быстрее, так как не выполняет запрос каждый раз, но данные могут устареть.

Ключевые отличия:
* Хранение данных: View — нет (виртуальная), Materialized View — да (физическая таблица).
* Актуальность данных: View — всегда актуальные, Materialized View — данные на момент последнего обновления.
* Производительность: View — медленнее (выполняет запрос), Materialized View — быстрее (читает готовые данные).
* Обновление: View — автоматически при каждом вызове, Materialized View — вручную или по расписанию (REFRESH).

__Автообновление материализованных представлений__ - это механизм, при котором СУБД автоматически обновляет данные в материализованном представлении по расписанию или при изменении исходных данных. Позволяет сохранять баланс между производительностью и актуальностью данных без ручного вмешательства.
